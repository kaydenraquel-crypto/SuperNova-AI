[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor
user=root

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

# SuperNova FastAPI Application
[program:supernova-api]
command=uvicorn main:app --host 0.0.0.0 --port 8081 --workers 2 --log-level info
directory=/app
user=supernova
autostart=true
autorestart=true
startretries=3
stderr_logfile=/app/logs/supernova-api-error.log
stdout_logfile=/app/logs/supernova-api.log
environment=PYTHONPATH="/app"

# Nginx Web Server
[program:nginx]
command=nginx -g "daemon off;"
autostart=true
autorestart=true
startretries=3
stderr_logfile=/var/log/supervisor/nginx-error.log
stdout_logfile=/var/log/supervisor/nginx.log
user=root

# Background Task Worker (if needed)
[program:supernova-worker]
command=python -m supernova.worker
directory=/app
user=supernova
autostart=true
autorestart=true
startretries=3
stderr_logfile=/app/logs/worker-error.log
stdout_logfile=/app/logs/worker.log
environment=PYTHONPATH="/app"
numprocs=2

# Scheduler for periodic tasks
[program:supernova-scheduler]
command=python -m supernova.scheduler
directory=/app
user=supernova
autostart=true
autorestart=true
startretries=3
stderr_logfile=/app/logs/scheduler-error.log
stdout_logfile=/app/logs/scheduler.log
environment=PYTHONPATH="/app"

# Log rotator
[program:logrotate]
command=logrotate -f /etc/logrotate.conf
autostart=false
autorestart=false
startsecs=0

[group:supernova]
programs=supernova-api,supernova-worker,supernova-scheduler
priority=999